

<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adding State Variables &#8212; Home</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/cyclus.css?v=a0e5ed17" />
    <link rel="stylesheet" type="text/css" href="../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=7558d08f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../_static/cloud.js"></script>
    

    <link rel="icon" href="../../_static/big_c.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Adding Buffers and Policies from the Toolkit" href="toolkit.html" />
    <link rel="prev" title="Setup a New Project Based on Cycstub" href="setup.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="toolkit.html" title="Adding Buffers and Policies from the Toolkit"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="setup.html" title="Setup a New Project Based on Cycstub"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Archetype Development Tutorial [C++]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding State Variables</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="adding-state-variables">
<h1>Adding State Variables<a class="headerlink" href="#adding-state-variables" title="Link to this heading">¶</a></h1>
<p>In this lesson, we will:</p>
<ol class="arabic simple">
<li><p>Add the necessary state variables to define this facility using the Cyclus
<code class="docutils literal notranslate"><span class="pre">#pragma</span></code> directives</p></li>
<li><p>Build and install the updated module</p></li>
<li><p>Modify the sample input file to include these variables</p></li>
</ol>
<section id="add-state-variables-with-cyclus-pragma">
<h2>Add State Variables with Cyclus #pragma<a class="headerlink" href="#add-state-variables-with-cyclus-pragma" title="Link to this heading">¶</a></h2>
<p>The Cyclus preprocessor provides a <code class="docutils literal notranslate"><span class="pre">#pragma</span></code> that defines variables to
be part of the set of state variables and allows convenient annotations.</p>
<p>First, we’ll add the maximum monthly transfer capacity, called <code class="docutils literal notranslate"><span class="pre">throughput</span></code>.
Open the file <code class="docutils literal notranslate"><span class="pre">src/storage.h</span></code> in your text editor.</p>
<p>Immediately after the declaration of <code class="docutils literal notranslate"><span class="pre">Tock()</span></code>, add the following:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma cyclus var { \</span>
<span class="cp">  &quot;doc&quot;: &quot;Maximum amount of material that can be transferred in or out each time step&quot;, \</span>
<span class="cp">  &quot;tooltip&quot;: &quot;Maximum amount of material that can be transferred in or out each time step&quot;, \</span>
<span class="cp">  &quot;units&quot;: &quot;kg&quot;, \</span>
<span class="cp">  &quot;uilabel&quot;: &quot;Maximum Throughput&quot; \</span>
<span class="cp">}</span>
<span class="kt">double</span><span class="w"> </span><span class="n">throughput</span><span class="p">;</span>
</pre></div>
</div>
<p>Now, we’ll add variables for the minimum amount of time that material is
stored and the input/output commodity names.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma cyclus var { \</span>
<span class="cp">  &quot;doc&quot;: &quot;Minimum amount of time material must be stored&quot;, \</span>
<span class="cp">  &quot;tooltip&quot;: &quot;Minimum amount of time material must be stored&quot;, \</span>
<span class="cp">  &quot;units&quot;: &quot;months&quot;, \</span>
<span class="cp">  &quot;uilabel&quot;: &quot;Storage Time&quot; \</span>
<span class="cp">}</span>
<span class="kt">int</span><span class="w"> </span><span class="n">storage_time</span><span class="p">;</span>

<span class="cp">#pragma cyclus var { \</span>
<span class="cp"> &quot;tooltip&quot;: &quot;Storage input commodity&quot;, \</span>
<span class="cp"> &quot;doc&quot;: &quot;Input commodity on which Storage requests material.&quot;, \</span>
<span class="cp"> &quot;uilabel&quot;: &quot;Input Commodity&quot;, \</span>
<span class="cp"> &quot;uitype&quot;: &quot;incommodity&quot;, \</span>
<span class="cp">}</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">incommod</span><span class="p">;</span>

<span class="cp">#pragma cyclus var { \</span>
<span class="cp"> &quot;tooltip&quot;: &quot;Storage output commodity&quot;, \</span>
<span class="cp"> &quot;doc&quot;: &quot;Output commodity on which Storage offers material.&quot;, \</span>
<span class="cp"> &quot;uilabel&quot;: &quot;Output Commodity&quot;, \</span>
<span class="cp"> &quot;uitype&quot;: &quot;outcommodity&quot;, \</span>
<span class="cp">}</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">outcommod</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="build-and-install-the-modified-module">
<h2>Build and Install the Modified Module<a class="headerlink" href="#build-and-install-the-modified-module" title="Link to this heading">¶</a></h2>
<p>To rebuild, reinstall, and test this module, just issue the same command as before:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./install.py
<span class="gp">$ </span>Storage_unit_tests
</pre></div>
</div>
</section>
<section id="modify-the-input-file">
<h2>Modify the Input File<a class="headerlink" href="#modify-the-input-file" title="Link to this heading">¶</a></h2>
<p>If you try to run the same input file with your modified module, you will get
errors because the sample input file no longer includes the necessary pieces
to define your module.  It is missing the new variables.  Try it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cyclus<span class="w"> </span>-v<span class="w"> </span><span class="m">2</span><span class="w"> </span>input/storage.xml
<span class="go">              :</span>
<span class="go">          .CL:CC CC             _Q     _Q  _Q_Q    _Q    _Q              _Q</span>
<span class="go">        CC;CCCCCCCC:C;         /_\)   /_\)/_/\\)  /_\)  /_\)            /_\)</span>
<span class="go">        CCCCCCCCCCCCCl       __O|/O___O|/O_OO|/O__O|/O__O|/O____________O|/O__</span>
<span class="go">     CCCCCCf     iCCCLCC     /////////////////////////////////////////////////</span>
<span class="go">     iCCCt  ;;;;;.  CCCC</span>
<span class="go">    CCCC  ;;;;;;;;;. CClL.                          c</span>
<span class="go">   CCCC ,;;       ;;: CCCC  ;                   : CCCCi</span>
<span class="go">    CCC ;;         ;;  CC   ;;:                CCC`   `C;</span>
<span class="go">  lCCC ;;              CCCC  ;;;:             :CC .;;. C;   ;    :   ;  :;;</span>
<span class="go">  CCCC ;.              CCCC    ;;;,           CC ;    ; Ci  ;    :   ;  :  ;</span>
<span class="go">   iCC :;               CC       ;;;,        ;C ;       CC  ;    :   ; .</span>
<span class="go">  CCCi ;;               CCC        ;;;.      .C ;       tf  ;    :   ;  ;.</span>
<span class="go">  CCC  ;;               CCC          ;;;;;;; fC :       lC  ;    :   ;    ;:</span>
<span class="go">   iCf ;;               CC         :;;:      tC ;       CC  ;    :   ;     ;</span>
<span class="go">  fCCC :;              LCCf      ;;;:         LC :.  ,: C   ;    ;   ; ;   ;</span>
<span class="go">  CCCC  ;;             CCCC    ;;;:           CCi `;;` CC.  ;;;; :;.;.  ; ,;</span>
<span class="go">    CCl ;;             CC    ;;;;              CCC    CCL</span>
<span class="go">   tCCC  ;;        ;; CCCL  ;;;                  tCCCCC.</span>
<span class="go">    CCCC  ;;     :;; CCCCf  ;                     ,L</span>
<span class="go">     lCCC   ;;;;;;  CCCL</span>
<span class="go">     CCCCCC  :;;  fCCCCC</span>
<span class="go">      . CCCC     CCCC .</span>
<span class="go">       .CCCCCCCCCCCCCi</span>
<span class="go">          iCCCCCLCf</span>
<span class="go">           .  C. ,</span>
<span class="go">              :</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Expecting an element throughput, got nothing</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Invalid sequence in interleave</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Element Storage failed to validate content</span>
<span class="go"> ERROR(core  ):Document failed schema validation</span>
</pre></div>
</div>
<p>The simulation now fails because it does not match the schema. You can view the schema with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cyclus<span class="w"> </span>--agent-schema<span class="w"> </span>tutorial:Storage:Storage
</pre></div>
</div>
<p>Notice that you were able to take advantage of the input file validation simply by using the <code class="docutils literal notranslate"><span class="pre">#pragma</span></code>.</p>
<p>Our failed cyclus simulation produced an output file that will need to be deleted.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rm<span class="w"> </span>cyclus.sqlite
</pre></div>
</div>
<p>Now, we’ll change that input file.  Open the file <code class="docutils literal notranslate"><span class="pre">input/storage.xml</span></code> in
your text editor, and find the prototype configuration for the single facility
named “OneFacility” that looks like this.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;facility&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>OneFacility<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;config&gt;</span>
<span class="w">    </span><span class="nt">&lt;Storage</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/facility&gt;</span>
</pre></div>
</div>
<p>We need to replace the <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> element with this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;config&gt;</span>
<span class="w">  </span><span class="nt">&lt;Storage&gt;</span>
<span class="w">    </span><span class="nt">&lt;throughput&gt;</span>10<span class="nt">&lt;/throughput&gt;</span>
<span class="w">    </span><span class="nt">&lt;storage_time&gt;</span>1<span class="nt">&lt;/storage_time&gt;</span>
<span class="w">    </span><span class="nt">&lt;incommod&gt;</span>fuel<span class="nt">&lt;/incommod&gt;</span>
<span class="w">    </span><span class="nt">&lt;outcommod&gt;</span>stored_fuel<span class="nt">&lt;/outcommod&gt;</span>
<span class="w">  </span><span class="nt">&lt;/Storage&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
<p>Now we can try it again:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cyclus<span class="w"> </span>-v<span class="w"> </span><span class="m">2</span><span class="w"> </span>input/storage.xml
<span class="go">              :</span>
<span class="go">          .CL:CC CC             _Q     _Q  _Q_Q    _Q    _Q              _Q</span>
<span class="go">        CC;CCCCCCCC:C;         /_\)   /_\)/_/\\)  /_\)  /_\)            /_\)</span>
<span class="go">        CCCCCCCCCCCCCl       __O|/O___O|/O_OO|/O__O|/O__O|/O____________O|/O__</span>
<span class="go">     CCCCCCf     iCCCLCC     /////////////////////////////////////////////////</span>
<span class="go">     iCCCt  ;;;;;.  CCCC</span>
<span class="go">    CCCC  ;;;;;;;;;. CClL.                          c</span>
<span class="go">   CCCC ,;;       ;;: CCCC  ;                   : CCCCi</span>
<span class="go">    CCC ;;         ;;  CC   ;;:                CCC`   `C;</span>
<span class="go">  lCCC ;;              CCCC  ;;;:             :CC .;;. C;   ;    :   ;  :;;</span>
<span class="go">  CCCC ;.              CCCC    ;;;,           CC ;    ; Ci  ;    :   ;  :  ;</span>
<span class="go">   iCC :;               CC       ;;;,        ;C ;       CC  ;    :   ; .</span>
<span class="go">  CCCi ;;               CCC        ;;;.      .C ;       tf  ;    :   ;  ;.</span>
<span class="go">  CCC  ;;               CCC          ;;;;;;; fC :       lC  ;    :   ;    ;:</span>
<span class="go">   iCf ;;               CC         :;;:      tC ;       CC  ;    :   ;     ;</span>
<span class="go">  fCCC :;              LCCf      ;;;:         LC :.  ,: C   ;    ;   ; ;   ;</span>
<span class="go">  CCCC  ;;             CCCC    ;;;:           CCi `;;` CC.  ;;;; :;.;.  ; ,;</span>
<span class="go">    CCl ;;             CC    ;;;;              CCC    CCL</span>
<span class="go">   tCCC  ;;        ;; CCCL  ;;;                  tCCCCC.</span>
<span class="go">    CCCC  ;;     :;; CCCCf  ;                     ,L</span>
<span class="go">     lCCC   ;;;;;;  CCCL</span>
<span class="go">     CCCCCC  :;;  fCCCCC</span>
<span class="go">      . CCCC     CCCC .</span>
<span class="go">       .CCCCCCCCCCCCCi</span>
<span class="go">          iCCCCCLCf</span>
<span class="go">           .  C. ,</span>
<span class="go">              :</span>
<span class="go">INFO1(core  ):Simulation set to run from start=0 to end=10</span>
<span class="go">INFO1(core  ):Beginning simulation</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>

<span class="go">Status: Cyclus run successful!</span>
<span class="go">Output location: cyclus.sqlite</span>
<span class="go">Simulation ID: 9f15b93c-9ab2-49bb-a14f-fef872e64ce8</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Adding State Variables</a><ul>
<li><a class="reference internal" href="#add-state-variables-with-cyclus-pragma">Add State Variables with Cyclus #pragma</a></li>
<li><a class="reference internal" href="#build-and-install-the-modified-module">Build and Install the Modified Module</a></li>
<li><a class="reference internal" href="#modify-the-input-file">Modify the Input File</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="setup.html"
                          title="Previous page">&larr; Setup a New Project Based on Cycstub</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="toolkit.html"
                          title="Next page">&rarr; Adding Buffers and Policies from the Toolkit</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="toolkit.html" title="Adding Buffers and Policies from the Toolkit"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="setup.html" title="Setup a New Project Based on Cycstub"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Archetype Development Tutorial [C++]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding State Variables</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2012-2024, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Mar 22, 2024.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>