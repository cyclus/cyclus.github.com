

<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adding State Variables &#8212; Home</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/cyclus.css?v=a0e5ed17" />
    <link rel="stylesheet" type="text/css" href="../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=7558d08f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../_static/cloud.js"></script>
    

    <link rel="icon" href="../../_static/big_c.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Adding Resource Buffers" href="toolkit.html" />
    <link rel="prev" title="Setup a New Project" href="setup.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="toolkit.html" title="Adding Resource Buffers"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="setup.html" title="Setup a New Project"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Archetype Development Tutorial [Python]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding State Variables</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="adding-state-variables">
<h1>Adding State Variables<a class="headerlink" href="#adding-state-variables" title="Link to this heading">¶</a></h1>
<p>In this lesson, we will:</p>
<p>1. Add the necessary state variables to define the storage facility
3. Modify the sample input file to include these variables</p>
<section id="add-state-variables">
<h2>Add State Variables<a class="headerlink" href="#add-state-variables" title="Link to this heading">¶</a></h2>
<p>The Cyclus Python interface preprocessor provides a <code class="docutils literal notranslate"><span class="pre">typesystem</span></code> module that help define
variables that are state variables for an archetype. These state vars also allow convenient
annotations.</p>
<p>First, we’ll add the maximum monthly transfer capacity, called <code class="docutils literal notranslate"><span class="pre">throughput</span></code>.
Open the file <code class="docutils literal notranslate"><span class="pre">tutorial/tut/agents.py</span></code> in your text editor.
Immediately after the storage class name, add the following:</p>
<p><strong>~/tutorial/tut/agents.py:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cyclus.agents</span> <span class="kn">import</span> <span class="n">Facility</span>
<span class="kn">import</span> <span class="nn">cyclus.typesystem</span> <span class="k">as</span> <span class="nn">ts</span>


<span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Facility</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;My storage facility.&quot;&quot;&quot;</span>

    <span class="c1"># this declares throughput to be of type double for purposes of storage</span>
    <span class="c1"># and user input</span>
    <span class="n">throughput</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Maximum amount of material that can be transferred in or &quot;</span>
            <span class="s2">&quot;out each time step&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Maximum amount of material that can be transferred in &quot;</span>
                <span class="s2">&quot;or out each time step&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">,</span>
        <span class="n">uilabel</span><span class="o">=</span><span class="s2">&quot;Maximum Throughput&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, World!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we’ll add variables for the minimum amount of time that material is
stored and the input/output commodity names.</p>
<p><strong>~/tutorial/tut/agents.py:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Facility</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;My storage facility.&quot;&quot;&quot;</span>
    <span class="o">...</span>
    <span class="n">storage_time</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Minimum amount of time material must be stored&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Minimum amount of time material must be stored&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;months&quot;</span><span class="p">,</span>
        <span class="n">uilabel</span><span class="o">=</span><span class="s2">&quot;Storage Time&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">incommod</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">String</span><span class="p">(</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Storage input commodity&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Input commodity on which Storage requests material.&quot;</span><span class="p">,</span>
        <span class="n">uilabel</span><span class="o">=</span><span class="s2">&quot;Input Commodity&quot;</span><span class="p">,</span>
        <span class="n">uitype</span><span class="o">=</span><span class="s2">&quot;incommodity&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">outcommod</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Storage output commodity&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Output commodity on which Storage offers material.&quot;</span><span class="p">,</span>
        <span class="n">uilabel</span><span class="o">=</span><span class="s2">&quot;Output Commodity&quot;</span><span class="p">,</span>
        <span class="n">uitype</span><span class="o">=</span><span class="s2">&quot;outcommodity&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="re-innstall-the-modified-module">
<h2>Re-innstall the Modified Module<a class="headerlink" href="#re-innstall-the-modified-module" title="Link to this heading">¶</a></h2>
<p>To reinstall this module, just issue the same <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> command as before:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/tutorial $ python setup.py install --user</span>
</pre></div>
</div>
</section>
<section id="modify-the-input-file">
<h2>Modify the Input File<a class="headerlink" href="#modify-the-input-file" title="Link to this heading">¶</a></h2>
<p>If you try to run the same input file with your modified module, you will get
errors because the sample input file no longer includes the necessary pieces
to define your module.  It is missing the new variables.  Try it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/tutorial $ cyclus -v 2 input/storage.py</span>
<span class="go">              :</span>
<span class="go">          .CL:CC CC             _Q     _Q  _Q_Q    _Q    _Q              _Q</span>
<span class="go">        CC;CCCCCCCC:C;         /_\)   /_\)/_/\\)  /_\)  /_\)            /_\)</span>
<span class="go">        CCCCCCCCCCCCCl       __O|/O___O|/O_OO|/O__O|/O__O|/O____________O|/O__</span>
<span class="go">     CCCCCCf     iCCCLCC     /////////////////////////////////////////////////</span>
<span class="go">     iCCCt  ;;;;;.  CCCC</span>
<span class="go">    CCCC  ;;;;;;;;;. CClL.                          c</span>
<span class="go">   CCCC ,;;       ;;: CCCC  ;                   : CCCCi</span>
<span class="go">    CCC ;;         ;;  CC   ;;:                CCC`   `C;</span>
<span class="go">  lCCC ;;              CCCC  ;;;:             :CC .;;. C;   ;    :   ;  :;;</span>
<span class="go">  CCCC ;.              CCCC    ;;;,           CC ;    ; Ci  ;    :   ;  :  ;</span>
<span class="go">   iCC :;               CC       ;;;,        ;C ;       CC  ;    :   ; .</span>
<span class="go">  CCCi ;;               CCC        ;;;.      .C ;       tf  ;    :   ;  ;.</span>
<span class="go">  CCC  ;;               CCC          ;;;;;;; fC :       lC  ;    :   ;    ;:</span>
<span class="go">   iCf ;;               CC         :;;:      tC ;       CC  ;    :   ;     ;</span>
<span class="go">  fCCC :;              LCCf      ;;;:         LC :.  ,: C   ;    ;   ; ;   ;</span>
<span class="go">  CCCC  ;;             CCCC    ;;;:           CCi `;;` CC.  ;;;; :;.;.  ; ,;</span>
<span class="go">    CCl ;;             CC    ;;;;              CCC    CCL</span>
<span class="go">   tCCC  ;;        ;; CCCL  ;;;                  tCCCCC.</span>
<span class="go">    CCCC  ;;     :;; CCCCf  ;                     ,L</span>
<span class="go">     lCCC   ;;;;;;  CCCL</span>
<span class="go">     CCCCCC  :;;  fCCCCC</span>
<span class="go">      . CCCC     CCCC .</span>
<span class="go">       .CCCCCCCCCCCCCi</span>
<span class="go">          iCCCCCLCf</span>
<span class="go">           .  C. ,</span>
<span class="go">              :</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Expecting an element throughput, got nothing</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Invalid sequence in interleave</span>
<span class="go">Entity: line 17: element Storage: Relax-NG validity error : Element Storage failed to validate content</span>
<span class="go"> ERROR(core  ):Document failed schema validation</span>
</pre></div>
</div>
<p>The simulation now fails because it does not match the schema. You can view the schema with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/tutorial $ cyclus --agent-schema :tut.agents:Storage</span>
</pre></div>
</div>
<p>Notice that you were able to take advantage of the input file validation simply by using
the special <code class="docutils literal notranslate"><span class="pre">typesystem</span></code> class attributes.</p>
<p>Our failed cyclus simulation produced an output file that will need to be deleted.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/tutorial $ rm cyclus.sqlite</span>
</pre></div>
</div>
<p>Now, we’ll change that input file.  Open the file <code class="docutils literal notranslate"><span class="pre">input/storage.py</span></code> in
your text editor, and find the prototype configuration for the single facility
named “OneFacility” that looks like this.</p>
<p><strong>~/tutorial/input/storage.py:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="c1"># ...</span>
<span class="s1">&#39;facility&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Storage&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;OneFacility&#39;</span><span class="p">}</span>
<span class="c1"># ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We need to replace the <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> element with this:</p>
<p><strong>~/tutorial/input/storage.py:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="c1"># ...</span>
<span class="s1">&#39;facility&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Storage&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="s1">&#39;storage_time&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s1">&#39;incommod&#39;</span><span class="p">:</span> <span class="s1">&#39;fuel&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;outcommod&#39;</span><span class="p">:</span> <span class="s1">&#39;stored_fuel&#39;</span><span class="p">,</span>
                            <span class="p">}},</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;OneFacility&#39;</span><span class="p">}</span>
<span class="c1"># ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we can try it again:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/tutorial $ cyclus -v 2 input/storage.py</span>
<span class="go">              :</span>
<span class="go">          .CL:CC CC             _Q     _Q  _Q_Q    _Q    _Q              _Q</span>
<span class="go">        CC;CCCCCCCC:C;         /_\)   /_\)/_/\\)  /_\)  /_\)            /_\)</span>
<span class="go">        CCCCCCCCCCCCCl       __O|/O___O|/O_OO|/O__O|/O__O|/O____________O|/O__</span>
<span class="go">     CCCCCCf     iCCCLCC     /////////////////////////////////////////////////</span>
<span class="go">     iCCCt  ;;;;;.  CCCC</span>
<span class="go">    CCCC  ;;;;;;;;;. CClL.                          c</span>
<span class="go">   CCCC ,;;       ;;: CCCC  ;                   : CCCCi</span>
<span class="go">    CCC ;;         ;;  CC   ;;:                CCC`   `C;</span>
<span class="go">  lCCC ;;              CCCC  ;;;:             :CC .;;. C;   ;    :   ;  :;;</span>
<span class="go">  CCCC ;.              CCCC    ;;;,           CC ;    ; Ci  ;    :   ;  :  ;</span>
<span class="go">   iCC :;               CC       ;;;,        ;C ;       CC  ;    :   ; .</span>
<span class="go">  CCCi ;;               CCC        ;;;.      .C ;       tf  ;    :   ;  ;.</span>
<span class="go">  CCC  ;;               CCC          ;;;;;;; fC :       lC  ;    :   ;    ;:</span>
<span class="go">   iCf ;;               CC         :;;:      tC ;       CC  ;    :   ;     ;</span>
<span class="go">  fCCC :;              LCCf      ;;;:         LC :.  ,: C   ;    ;   ; ;   ;</span>
<span class="go">  CCCC  ;;             CCCC    ;;;:           CCi `;;` CC.  ;;;; :;.;.  ; ,;</span>
<span class="go">    CCl ;;             CC    ;;;;              CCC    CCL</span>
<span class="go">   tCCC  ;;        ;; CCCL  ;;;                  tCCCCC.</span>
<span class="go">    CCCC  ;;     :;; CCCCf  ;                     ,L</span>
<span class="go">     lCCC   ;;;;;;  CCCL</span>
<span class="go">     CCCCCC  :;;  fCCCCC</span>
<span class="go">      . CCCC     CCCC .</span>
<span class="go">       .CCCCCCCCCCCCCi</span>
<span class="go">          iCCCCCLCf</span>
<span class="go">           .  C. ,</span>
<span class="go">              :</span>
<span class="go">INFO1(core  ):Simulation set to run from start=0 to end=10</span>
<span class="go">INFO1(core  ):Beginning simulation</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>
<span class="go">INFO1(tutori):Hello</span>
<span class="go">INFO1(tutori):World!</span>

<span class="go">Status: Cyclus run successful!</span>
<span class="go">Output location: cyclus.sqlite</span>
<span class="go">Simulation ID: 9f15b93c-9ab2-49bb-a14f-fef872e64ce8</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Adding State Variables</a><ul>
<li><a class="reference internal" href="#add-state-variables">Add State Variables</a></li>
<li><a class="reference internal" href="#re-innstall-the-modified-module">Re-innstall the Modified Module</a></li>
<li><a class="reference internal" href="#modify-the-input-file">Modify the Input File</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="setup.html"
                          title="Previous page">&larr; Setup a New Project</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="toolkit.html"
                          title="Next page">&rarr; Adding Resource Buffers</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="toolkit.html" title="Adding Resource Buffers"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="setup.html" title="Setup a New Project"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Archetype Development Tutorial [Python]</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding State Variables</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2012-2024, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Mar 22, 2024.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>