

<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Custom Database Tables &#8212; Home</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/cyclus.css?v=a0e5ed17" />
    <link rel="stylesheet" type="text/css" href="../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=7558d08f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="icon" href="../_static/big_c.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Errors and Warnings [C++]" href="errors.html" />
    <link rel="prev" title="Database Types" href="dbtypes.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="errors.html" title="Errors and Warnings [C++]"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Custom Database Tables</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="custom-database-tables">
<h1>Custom Database Tables<a class="headerlink" href="#custom-database-tables" title="Link to this heading">¶</a></h1>
<p>Agents are allowed to write their own custom output into the database during
simulations.  The interface for recording this data is accessible through the
agent’s <a class="reference internal" href="../basics/glossary.html#term-context"><span class="xref std std-term">context</span></a>.  Data may be logged via the Context::NewDatum function:</p>
<p><strong>C++:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">MyReactor</span><span class="o">::</span><span class="n">Tick</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">monthly_water</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">monthly_op_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>

<span class="w">  </span><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;MyReactorData&quot;</span><span class="p">)</span>
<span class="w">           </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">())</span>
<span class="w">           </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
<span class="w">           </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;WaterUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">monthl_water</span><span class="p">)</span>
<span class="w">           </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;OperatingCost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">monthly_op_cost</span><span class="p">)</span>
<span class="w">           </span><span class="o">-&gt;</span><span class="n">Record</span><span class="p">();</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Python:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cyclus.agents</span> <span class="kn">import</span> <span class="n">Facility</span>
<span class="kn">import</span> <span class="nn">cyclus.typesystem</span> <span class="k">as</span> <span class="nn">ts</span>

<span class="k">class</span> <span class="nc">MyReactor</span><span class="p">(</span><span class="n">Facility</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">new_datum</span><span class="p">(</span><span class="s2">&quot;MyReactorData&quot;</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;AgentID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;WaterUsage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monthl_water</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;OperatingCost&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">monthly_op_cost</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">record</span><span class="p">()</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>This would create a table in the output database named “MyReactorData”. The
table would get a new row entry every time step with four columns named
“AgentID”, “Time”, “WaterUsage” and “OperatingCost”.  “Add value” calls can be chained
any number of times for an arbitrary number of columns.  Record must be
called once for each datum after all values have been added.  Any custom
tables created in this manner will appear in the output database alongside the
<span style="font-variant:small-caps;">Cyclus</span> core tables.  Because there may be several agent instances of a
single agent class, tables should generally include a column that adds their
ID; and for similar reasons, it is often desirable to include the simulation
time as a column in these tables:</p>
<p><strong>C++:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;MyReactorData&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">())</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(...</span>
<span class="w">         </span><span class="p">...</span>
</pre></div>
</div>
<p><strong>Python:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">new_datum</span><span class="p">(</span><span class="s2">&quot;MyReactorData&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;AgentID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">add_val</span><span class="p">(</span><span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Datums with the same table name must have the same schema (e.g. same field
names and value types). It is the responsibility of the developer to
enforce this in their code.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Database formats only support a finite number of datum value-types.  Do not
add values to database tables that are not supported by the backend(s) in
use. For information on which c++ types the backends support, you can check
<a class="reference internal" href="dbtypes.html"><span class="doc">here</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you require a datatype that isn’t currently supported, please
ask the kernel developers and they will help as soon as possible.</p>
</div>
<section id="table-data-shapes">
<h2>Table Data Shapes<a class="headerlink" href="#table-data-shapes" title="Link to this heading">¶</a></h2>
<p>All added values can optionally take a <cite>std::vector&lt;int&gt;*</cite> shape argument that
is used as maximum dimensions for the value being added.  The <a class="reference internal" href="dbtypes.html"><span class="doc">Database Types</span></a>
page lists the rank of the shape of different C++ types.  A
<code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::string&gt;</span></code> has rank two - the first shape element being the
length of the vector, the second element being the length of each string in
the vector.  When the shape argument is ommitted, the default is to treat all
elements in the value as variable-length.  An entry of <cite>-1</cite> in the shape
vector indicates variable length also.  It is an error to pass in a shape
vector with the wrong rank (number of elements) for that type.  An example of
using the shape vector follows:</p>
<p><strong>C++:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">colors</span><span class="p">;</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">);</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">);</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;chartreuse&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shape</span><span class="p">;</span><span class="w"> </span><span class="c1">// this should usually be a class member variable</span>
<span class="n">shape</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// maximum number of elements in the color vector</span>
<span class="n">shape</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span><span class="w"> </span><span class="c1">// maximum character length of each color</span>

<span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;DecorPreferences&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">())</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;FavoriteColors&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colors</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="p">)</span>
<span class="w">         </span><span class="o">-&gt;</span><span class="n">Record</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>Python:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;chartreuse&quot;</span><span class="p">]</span>
<span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span>
<span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">new_datum</span><span class="p">(</span><span class="s">&quot;DecorPreferences&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="p">.</span><span class="n">add_val</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">ts</span><span class="p">.</span><span class="n">INT</span><span class="p">)</span>
<span class="n">d</span><span class="p">.</span><span class="n">add_val</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">ts</span><span class="p">.</span><span class="n">INT</span><span class="p">)</span>
<span class="n">d</span><span class="p">.</span><span class="n">add_val</span><span class="p">(</span><span class="s">&quot;FavoriteColors&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colors</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">VECTOR_STRING</span><span class="p">)</span>
<span class="n">d</span><span class="p">.</span><span class="n">record</span><span class="p">()</span>
</pre></div>
</div>
<p>In the example above, the “chartreuse” color is longer than the 8 characters
specified in the shape.  So it will be truncated to “chartreu” in the
database. Shape vectors should generally be stored as class member variables
to avoid excessive memory [de]allocation and should be set correctly from
construction to destruction of your agent.</p>
</section>
<section id="reserved-table-names">
<h2>Reserved Table Names<a class="headerlink" href="#reserved-table-names" title="Link to this heading">¶</a></h2>
<p>The <span style="font-variant:small-caps;">Cyclus</span> kernel creates several of its own tables.  The names of these
tables are reserved, and you are responsible to avoid using them for custom
table names.  The reserved table names are (all case combos upper and lower):</p>
<ul>
<li><p>all names starting with the prefixes:</p>
<blockquote>
<div><ul class="simple">
<li><p>Cyclus</p></li>
<li><p>Agent</p></li>
<li><p>VL_</p></li>
<li><p>Pair</p></li>
<li><p>String</p></li>
<li><p>Vector</p></li>
<li><p>Map</p></li>
<li><p>List</p></li>
<li><p>Set</p></li>
<li><p>Blob</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Resources</p></li>
<li><p>Products</p></li>
<li><p>Transactions</p></li>
<li><p>Info</p></li>
<li><p>Finish</p></li>
<li><p>InputFiles</p></li>
<li><p>Prototypes</p></li>
<li><p>Recipes</p></li>
<li><p>Snapshots</p></li>
<li><p>MaterialInfo</p></li>
<li><p>Compositions</p></li>
<li><p>NextIds</p></li>
<li><p>ResCreators</p></li>
<li><p>CommodPriority</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Table names may only contain alphanumeric characters and underscores and
must not start with a number.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Custom Database Tables</a><ul>
<li><a class="reference internal" href="#table-data-shapes">Table Data Shapes</a></li>
<li><a class="reference internal" href="#reserved-table-names">Reserved Table Names</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="dbtypes.html"
                          title="Previous page">&larr; Database Types</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="errors.html"
                          title="Next page">&rarr; Errors and Warnings [C++]</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="errors.html" title="Errors and Warnings [C++]"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Custom Database Tables</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2012-2024, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Mar 22, 2024.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>