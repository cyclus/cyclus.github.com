

<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CEP 23 - Defining Time Step Length, High Noon for Blue Moon &#8212; Home</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/cyclus.css?v=a0e5ed17" />
    <link rel="stylesheet" type="text/css" href="../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=8cf7d53e"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="icon" href="../_static/big_c.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CEP 24 - Default Preferences" href="cep24.html" />
    <link rel="prev" title="CEP 22 - Logging Methodology and Implementation" href="cep22.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="cep24.html" title="CEP 24 - Default Preferences"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="cep22.html" title="CEP 22 - Logging Methodology and Implementation"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="cep0.html" accesskey="U"><span style="font-variant:small-caps;">Cyclus</span> Enhancement Proposals</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CEP 23 - Defining Time Step Length, High Noon for Blue Moon</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="cep-23-defining-time-step-length-high-noon-for-blue-moon">
<h1>CEP 23 - Defining Time Step Length, High Noon for Blue Moon<a class="headerlink" href="#cep-23-defining-time-step-length-high-noon-for-blue-moon" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">CEP<span class="colon">:</span></dt>
<dd class="field-odd"><p>23</p>
</dd>
<dt class="field-even">Title<span class="colon">:</span></dt>
<dd class="field-even"><p>Defining Time Step Length, High Noon for Blue Moon</p>
</dd>
<dt class="field-odd">Last-Modified<span class="colon">:</span></dt>
<dd class="field-odd"><p>2014-12-01</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Anthony Scopatz</p>
</dd>
<dt class="field-odd">BDFP<span class="colon">:</span></dt>
<dd class="field-odd"><p>Paul P. H. Wilson</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Standards Track</p>
</dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even"><p>2014-12-01</p>
</dd>
</dl>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<p>Cyclus is a discrete time simulator whose assumed default time step is
months. Months are the worst unit ever. This proposal adds precision and
flexibility to what we mean by <span class="math notranslate nohighlight">\(\delta t\)</span>. Namely, this CEP moves from
months to seconds and allows the user to set the time step length, preserving
a default length of a Julian month.</p>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">¶</a></h2>
<p>Cyclus lacks a canonical time system. This CEP seeks to unambiguously define
the seconds as the default time unit.  This allows agents to unambiguously
communicate with each other and to determine their own time scales internally.
This CEP also adds the capability for users to specify a time step length
(<span class="math notranslate nohighlight">\(\delta t\)</span>) of their choosing. The default time step, if unspecified,
will be a well-defined month, improving on the historically nebulous month.</p>
<p>This CEP is motivated by our past woes with months.
Months are an awful time step because there is no single definition for what a
month <em>is</em> and all definitions lack a physical basis. Days and years map nicely
(enough) onto a solar cycle. A lunar cycle is 29.53059 days with 7.4 days per phase.
This does not map on well to any solar equivalent.  In fact, a 12 month lunar year
is only 354.36708 days, which is a far cry from a solar year.  This is why many
lunar calendars are, in fact, lunisolar. Various strategies
for dealing with this time defect are either to add an extra months occasionally
or to have non-month days between years.</p>
<p>As physically impossible as it is to perfectly sync the sun and the moon,
it is an even worse idea to implement a full Gregorian calendar. Like with
time zones, the opportunities for failure are nearly endless. Furthermore,
going with a real calendar breaks with the current notion that all time steps
have an equal <span class="math notranslate nohighlight">\(\delta t\)</span>.</p>
</section>
<section id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="Link to this heading">¶</a></h2>
<p>This CEP defines the default time step as the average length of a Julian
month as measured in seconds, the proper unit for time:</p>
<div class="math notranslate nohighlight">
\[\delta t = \frac{365.25 [d]}{12} = \frac{31557600 [s]}{12} = 2629800 [s/m]\]</div>
<p>Furthermore, this actual time step should be able to be set by the user in the
input file. The following changes to the master schema(s) are thus needed:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name =</span><span class="s">&quot;control&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;interleave&gt;</span>
<span class="w">    </span>.<span class="w"> </span>.<span class="w"> </span>.
<span class="w">    </span><span class="nt">&lt;optional&gt;</span>
<span class="w">      </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dt&quot;</span><span class="nt">&gt;&lt;data</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;unsignedLong&quot;</span><span class="err">/&lt;/element</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/optional&gt;</span>
<span class="w">    </span><span class="nt">&lt;optional&gt;</span>
<span class="w">      </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dt_units&quot;</span><span class="nt">&gt;&lt;data</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;token&quot;</span><span class="err">/&lt;/element</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/optional&gt;</span>
<span class="w">  </span><span class="nt">&lt;/interleave&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</pre></div>
</div>
<p>This information would be added to the context with the following members:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Context</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="c1">// Returns the time step in seconds</span>
<span class="w">  </span><span class="kr">inline</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dt_</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// Returns the time step in [units], given as string</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="nf">dt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">units</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Returns the time step in [units], given as TimeUnits enum</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="nf">dt</span><span class="p">(</span><span class="n">TimeUnits</span><span class="w"> </span><span class="n">units</span><span class="p">);</span>

<span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dt_</span><span class="p">;</span><span class="w">  </span><span class="c1">// the length of the time step, in seconds.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All archetypes and toolkit code should then ask the context what the time step
size is whenever they actually need the current. As per <a class="reference external" href="cep20.html">CEP20</a>,
the time step length is fixed for the entire simulation and may not change.</p>
<p>Furthermore, <code class="docutils literal notranslate"><span class="pre">TimeUnits</span></code> will be a fixed set of time increments that will
not be able to be set by the users.  An initial set of time units are:
s, min, hr, d, month (as defined above), y, ky, My, Gy.</p>
<section id="best-practices">
<h3>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h3>
<p>Along with this CEP comes the best practice that
archetypes which model time-dependent behavior should not
assume a nominal time step. Archetypes should always get the time step length
from the context.  Since the time step is fixed, this need only be done once
per prototype.</p>
<p>From here, we also define two broad archetype classifications: those which care
about actual real physical time and those which simply function per
simulation time step.</p>
<p>When an archetype uses real time, due to physics calculations or other needs,
the archetype should now check that <span class="math notranslate nohighlight">\(\delta t\)</span> is within a valid range
that they define. This is because users will now be able to set the time step.
This validation check maybe performed in any of the archetype’s member functions.
If a static range is known ahead of time, then this check is most appropriate in
the constructor. If the time step length is outside of the valid range of the agent,
then an exception should be raised.  We recommend something along the lines of:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">().</span><span class="n">dt</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_dt</span><span class="p">)</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="n">cyclus</span><span class="o">::</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">&quot;time step exceeds valid range!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>On the other hand, if the archtype only models per time step behavior, then
state variables should be expressible by default in terms of number of time steps,
not in terms of seconds.  If other time values are desirable, the user
should explicitly give the time units. For any time-based variable, the default
associated units should be provided by the metadata.</p>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">¶</a></h2>
<p>The implementation of this code should be fairly straight forward. Unlike time
itself, there is no funny business here.</p>
</section>
<section id="document-history">
<h2>Document History<a class="headerlink" href="#document-history" title="Link to this heading">¶</a></h2>
<p>This document is released under the CC-BY 4.0 license.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">CEP 23 - Defining Time Step Length, High Noon for Blue Moon</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#discussion">Discussion</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#best-practices">Best Practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#document-history">Document History</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="cep22.html"
                          title="Previous page">&larr; CEP 22 - Logging Methodology and Implementation</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="cep24.html"
                          title="Next page">&rarr; CEP 24 - Default Preferences</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="cep24.html" title="CEP 24 - Default Preferences"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="cep22.html" title="CEP 22 - Logging Methodology and Implementation"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="cep0.html" ><span style="font-variant:small-caps;">Cyclus</span> Enhancement Proposals</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CEP 23 - Defining Time Step Length, High Noon for Blue Moon</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2012-2024, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Apr 01, 2024.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>